(()=>{(function(){let a={primaryColor:"#0066CC",agentBubbleColor:"#E9E9EB",userBubbleColor:"#0066CC",agentTextColor:"#000000",userTextColor:"#FFFFFF",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',apiUrl:window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="::1"||window.location.hostname.startsWith("192.168.")||window.location.hostname.startsWith("10.")?"http://localhost:3000/api/widget":"https://app.dialhank.com/api/widget"},l='.hank-widget-container{position: fixed;bottom: 20px;right: 20px;z-index: 99999;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;display: flex;flex-direction: column;align-items: flex-end;}.hank-widget-launcher{width: 60px;height: 60px;border-radius: 30px;background-color: #007AFF;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);cursor: pointer;display: flex;align-items: center;justify-content: center;transition: transform 0.2s ease;position: relative;}.hank-widget-badge{position: absolute;top: -5px;right: -5px;background-color: #FF3B30;color: white;border-radius: 50%;width: 24px;height: 24px;display: flex;align-items: center;justify-content: center;font-size: 12px;font-weight: bold;border: 2px solid white;box-shadow: 0 2px 4px rgba(0,0,0,0.2);}.hank-widget-launcher:hover{transform: scale(1.05);}.hank-widget-launcher svg{width: 30px;height: 30px;fill: white;}.hank-widget-window{position: fixed;bottom: 90px;right: 20px;width: 375px;height: 600px;max-height: calc(100vh - 120px);background-color: #fff;border-radius: 18px;box-shadow: 0 5px 40px rgba(0,0,0,0.16);display: flex;flex-direction: column;overflow: hidden;transition: opacity 0.3s ease, transform 0.3s ease;opacity: 0;transform: translateY(20px);pointer-events: none;}.hank-widget-window.open{opacity: 1;transform: translateY(0);pointer-events: all;}/* Mobile responsiveness */ @media (max-width: 480px){.hank-widget-window{width: 100%;height: 100%;max-height: 100%;bottom: 0;right: 0;border-radius: 0;}}.hank-noscroll{overflow: hidden !important;}.hank-widget-header{padding: 16px;background-color: rgba(242, 242, 247, 0.8);backdrop-filter: blur(20px);-webkit-backdrop-filter: blur(20px);border-bottom: 1px solid rgba(0,0,0,0.1);display: flex;align-items: center;justify-content: space-between;position: absolute;top: 0;left: 0;width: 100%;z-index: 10;box-sizing: border-box;}.hank-widget-header-content{display: flex;align-items: center;gap: 12px;}.hank-widget-avatar{width: 48px;height: 48px;border-radius: 50%;background: linear-gradient(135deg, #4ade80 0%, #10b981 50%, #0d9488 100%);display: flex;align-items: center;justify-content: center;color: white;font-weight: bold;font-size: 20px;}.hank-widget-title{font-size: 16px;font-weight: 600;color: #000;}.hank-widget-subtitle{font-size: 12px;color: #8e8e93;}.hank-widget-close{background: none;border: none;cursor: pointer;color: #8e8e93;padding: 4px;}.hank-widget-messages{flex: 1;overflow-y: auto;padding: 16px;padding-top: 90px;/* Space for absolute header */ background-color: #fff;display: flex;flex-direction: column;gap: 8px;}.hank-message{max-width: 75%;padding: 10px 16px;border-radius: 20px;font-size: 16px;line-height: 1.4;position: relative;word-wrap: break-word;}.hank-message.agent{align-self: flex-start;background-color: #E9E9EB;color: #000000;border-bottom-left-radius: 4px;}.hank-message.user{align-self: flex-end;background-color: #007AFF;color: #FFFFFF;border-bottom-right-radius: 4px;}.hank-widget-input-area{padding: 16px;background-color: #f9f9f9;border-top: 1px solid rgba(0,0,0,0.1);display: flex;align-items: center;gap: 10px;}.hank-widget-input{flex: 1;border: 1px solid #c6c6c8;border-radius: 20px;padding: 8px 16px;font-size: 16px;outline: none;font-family: inherit;resize: none;height: 36px;max-height: 100px;line-height: 20px;overflow-y: auto;/* Hide scrollbar on all devices */ scrollbar-width: none;/* Firefox */ -ms-overflow-style: none;/* IE and Edge */}.hank-widget-input::-webkit-scrollbar{display: none;/* Chrome, Safari, Opera */}.hank-widget-input:focus{border-color: #007AFF;}.hank-widget-send{background: none;border: none;cursor: pointer;color: #007AFF;padding: 4px;display: flex;align-items: center;justify-content: center;}.hank-widget-send:disabled{opacity: 0.5;cursor: not-allowed;}.hank-message-timestamp{font-size: 10px;margin-top: 4px;opacity: 0.6;text-align: right;}.hank-typing-indicator{display: flex;gap: 4px;padding: 12px 16px;background-color: #E9E9EB;border-radius: 20px;border-bottom-left-radius: 4px;align-self: flex-start;width: fit-content;}.hank-typing-dot{width: 6px;height: 6px;background-color: #8e8e93;border-radius: 50%;animation: hank-bounce 1.4s infinite ease-in-out both;}.hank-typing-dot:nth-child(1){animation-delay: -0.32s;}.hank-typing-dot:nth-child(2){animation-delay: -0.16s;}@keyframes hank-bounce{0%, 80%, 100%{transform: scale(0);}40%{transform: scale(1);}}.hank-chips-container{display: flex;flex-wrap: wrap;gap: 8px;padding: 0 4px 8px 4px;margin-top: auto;/* Push to bottom of message area */}.hank-chip{background-color: #F2F2F7;border: 1px solid #E5E5EA;border-radius: 16px;padding: 8px 12px;font-size: 14px;color: #007AFF;cursor: pointer;transition: all 0.2s;font-weight: 500;display: flex;align-items: center;gap: 6px;}.hank-chip svg{width: 16px;height: 16px;}.hank-chip:hover{background-color: #E5E5EA;transform: translateY(-1px);}';function h(n){let t=`; ${document.cookie}`.split(`; ${n}=`);return t.length===2?t.pop().split(";").shift():null}function r(n,e,t=30){let i=new Date;i.setTime(i.getTime()+t*24*60*60*1e3);let s=`expires=${i.toUTCString()}`;document.cookie=`${n}=${e};${s};path=/;SameSite=Lax`}class o{constructor(){this.isOpen=!1,this.messages=[],this.chips=[{label:"Water Damage",message:"I have water damage.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>'},{label:"Fire Damage",message:"I have fire damage.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.1758045,11.5299649 C11.7222481,10.7630248 11.6612694,9.95529555 11.2823626,8.50234466 C10.5329929,5.62882187 10.8313891,4.05382867 13.4147321,2.18916004 L14.6756139,1.27904986 L14.9805807,2.80388386 C15.3046861,4.42441075 15.8369398,5.42670671 17.2035766,7.35464078 C17.2578735,7.43122022 17.2578735,7.43122022 17.3124108,7.50814226 C19.2809754,10.2854144 20,11.9596204 20,15 C20,18.6883517 16.2713564,22 12,22 C7.72840879,22 4,18.6888043 4,15 C4,14.9310531 4.00007066,14.9331427 3.98838852,14.6284506 C3.89803284,12.2718054 4.33380946,10.4273676 6.09706666,8.43586022 C6.46961415,8.0150872 6.8930834,7.61067534 7.36962714,7.22370749 L8.42161802,6.36945926 L8.9276612,7.62657706 C9.30157948,8.55546878 9.73969716,9.28566491 10.2346078,9.82150804 C10.6537848,10.2753538 10.9647401,10.8460665 11.1758045,11.5299649 Z M7.59448531,9.76165711 C6.23711779,11.2947332 5.91440928,12.6606068 5.98692012,14.5518252 C6.00041903,14.9039019 6,14.8915108 6,15 C6,17.5278878 8.78360021,20 12,20 C15.2161368,20 18,17.527472 18,15 C18,12.4582072 17.4317321,11.1350292 15.6807305,8.66469725 C15.6264803,8.58818014 15.6264803,8.58818014 15.5719336,8.51124844 C14.5085442,7.0111098 13.8746802,5.96758691 13.4553336,4.8005211 C12.7704786,5.62117775 12.8107447,6.43738988 13.2176374,7.99765534 C13.9670071,10.8711781 13.6686109,12.4461713 11.0852679,14.31084 L9.61227259,15.3740546 L9.50184911,13.5607848 C9.43129723,12.4022487 9.16906461,11.6155508 8.76539217,11.178492 C8.36656566,10.7466798 8.00646835,10.2411426 7.68355027,9.66278925 C7.65342985,9.69565638 7.62374254,9.72861259 7.59448531,9.76165711 Z"/></svg>'},{label:"Mold Removal",message:"I have a mold problem.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>'},{label:"Book Appointment",message:"I'd like to schedule an appointment.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>'},{label:"Emergency",message:"I have an emergency.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>'},{label:"General Question",message:"I have a general question.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>'}],this.showChips=!0,this.isTyping=!1,this.init()}async init(){this.injectStyles(),this.createDOM(),this.attachEvents(),this.originalTitle=document.title;let e=h("hank_chat_id"),t=!1;e?(this.chatId=e,t=await this.loadChatHistory()):await this.createChatSession(),t&&window.innerWidth>768&&this.toggle(!0),setTimeout(()=>{t||(this.playNotificationSound(),this.addInitialMessage(),this.showBadge(),this.startTitleNotification()),!t&&window.innerWidth>768&&this.toggle(!0)},3e3)}async createChatSession(){try{let t=await(await fetch(`${a.apiUrl}/chat`,{method:"POST"})).json();this.chatId=t.chatId,this.chatId&&r("hank_chat_id",this.chatId,30)}catch(e){console.error("Failed to create chat session:",e)}}async loadChatHistory(){if(!this.chatId)return!1;try{let e=await fetch(`${a.apiUrl}/messages?chatId=${this.chatId}`);if(!e.ok)return await this.createChatSession(),!1;let t=await e.json();return t.messages&&t.messages.length>0?(this.showChips=!1,this.messages=t.messages.map(i=>({id:i.id,text:i.text,sender:i.sender,timestamp:new Date(i.timestamp)})),this.renderMessages(),!0):!1}catch(e){return console.error("Failed to load chat history:",e),await this.createChatSession(),!1}}addInitialMessage(){this.messages.push({id:1,text:"Hey, is there anything I can help you with?",sender:"agent",timestamp:new Date}),this.renderMessages()}showBadge(){this.badge.style.display="flex",this.badge.innerText="1"}hideBadge(){this.badge.style.display="none",this.stopTitleNotification()}startTitleNotification(){if(this.titleInterval)return;let e=!1;this.titleInterval=setInterval(()=>{document.title=e?`(1) ${this.originalTitle}`:this.originalTitle,e=!e},2e3)}stopTitleNotification(){this.titleInterval&&(clearInterval(this.titleInterval),this.titleInterval=null,document.title=this.originalTitle)}playNotificationSound(){try{let e=window.AudioContext||window.webkitAudioContext;if(!e)return;let t=new e,i=t.createOscillator(),s=t.createGain();i.connect(s),s.connect(t.destination),i.type="sine",i.frequency.setValueAtTime(880,t.currentTime),i.frequency.exponentialRampToValueAtTime(440,t.currentTime+.1),s.gain.setValueAtTime(.1,t.currentTime),s.gain.exponentialRampToValueAtTime(.001,t.currentTime+.5),i.start(),i.stop(t.currentTime+.5)}catch(e){console.log("Audio playback failed (likely due to autoplay policy)",e)}}injectStyles(){let e=document.createElement("style");e.innerText=l,document.head.appendChild(e)}createDOM(){this.container=document.createElement("div"),this.container.className="hank-widget-container",this.window=document.createElement("div"),this.window.className="hank-widget-window",this.window.innerHTML=`
        <div class="hank-widget-header">
          <div class="hank-widget-header-content">
            <div class="hank-widget-avatar">H</div>
            <div>
              <div class="hank-widget-title">Hank</div>
              <div class="hank-widget-subtitle">Technician @ Cleaner Guys</div>
            </div>
          </div>
          <button class="hank-widget-close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>
        <div class="hank-widget-messages"></div>
        <div class="hank-widget-input-area">
          <textarea class="hank-widget-input" placeholder="Type a message..." rows="1"></textarea>
          <button class="hank-widget-send" disabled>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
          </button>
        </div>
      `,this.launcher=document.createElement("div"),this.launcher.className="hank-widget-launcher",this.launcher.innerHTML=`
        <div class="hank-widget-badge" style="display:none;">1</div>
        <svg class="hank-icon-open" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        <svg class="hank-icon-close" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none;"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      `,this.container.appendChild(this.window),this.container.appendChild(this.launcher),document.body.appendChild(this.container),this.messagesContainer=this.window.querySelector(".hank-widget-messages"),this.input=this.window.querySelector(".hank-widget-input"),this.sendBtn=this.window.querySelector(".hank-widget-send"),this.closeBtn=this.window.querySelector(".hank-widget-close"),this.badge=this.launcher.querySelector(".hank-widget-badge")}attachEvents(){this.launcher.addEventListener("click",()=>this.toggle()),this.closeBtn.addEventListener("click",()=>this.toggle(!1)),this.input.addEventListener("input",e=>{this.sendBtn.disabled=!e.target.value.trim(),this.hideBadge(),e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"}),this.input.addEventListener("keydown",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.sendMessage())}),this.sendBtn.addEventListener("click",()=>this.sendMessage()),window.addEventListener("resize",()=>{this.updateLauncherVisibility()})}updateLauncherVisibility(){let e=window.innerWidth<=480;this.isOpen&&e?(this.launcher.style.display="none",document.body.classList.add("hank-noscroll")):this.isOpen&&!e?(this.launcher.style.display="flex",document.body.classList.remove("hank-noscroll")):this.isOpen||(this.launcher.style.display="flex",document.body.classList.remove("hank-noscroll"))}toggle(e){typeof e=="boolean"?this.isOpen=e:this.isOpen=!this.isOpen;let t=window.innerWidth<=480;this.isOpen?(this.window.classList.add("open"),this.launcher.querySelector(".hank-icon-open").style.display="none",this.launcher.querySelector(".hank-icon-close").style.display="block",this.updateLauncherVisibility(),setTimeout(()=>this.input.focus(),300)):(this.window.classList.remove("open"),this.launcher.style.display="flex",this.launcher.querySelector(".hank-icon-open").style.display="block",this.launcher.querySelector(".hank-icon-close").style.display="none",document.body.classList.remove("hank-noscroll"),this.stopTitleNotification())}renderMessages(){if(this.messagesContainer.innerHTML="",this.messages.forEach(e=>{let t=document.createElement("div");t.className=`hank-message ${e.sender}`,t.innerText=e.text,this.messagesContainer.appendChild(t)}),this.showChips&&!this.isTyping){let e=document.createElement("div");e.className="hank-chips-container",this.chips.forEach(t=>{let i=document.createElement("button");i.className="hank-chip",i.innerHTML=`${t.icon}<span>${t.label}</span>`,i.onclick=()=>this.handleChipClick(t.message),e.appendChild(i)}),this.messagesContainer.appendChild(e)}if(this.isTyping){let e=document.createElement("div");e.className="hank-typing-indicator",e.innerHTML='<div class="hank-typing-dot"></div><div class="hank-typing-dot"></div><div class="hank-typing-dot"></div>',this.messagesContainer.appendChild(e)}this.scrollToBottom()}handleChipClick(e){this.input.value=e,this.showChips=!1,this.sendMessage()}scrollToBottom(){this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}async sendMessage(){let e=this.input.value.trim();if(e){this.showChips=!1,this.messages.push({id:Date.now(),text:e,sender:"user",timestamp:new Date}),this.input.value="",this.input.style.height="36px",this.sendBtn.disabled=!0,this.renderMessages(),this.isTyping=!0,this.renderMessages();try{this.chatId||await this.createChatSession();let s=(await(await fetch(`${a.apiUrl}/message`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:this.chatId,content:e})})).json()).messages?.[0]?.content||"Sorry, I couldn't process that.";this.messages.push({id:Date.now()+1,text:s,sender:"agent",timestamp:new Date})}catch(t){console.error("Error sending message:",t),this.messages.push({id:Date.now()+1,text:"Sorry, I'm having trouble connecting right now. Please try again later.",sender:"agent",timestamp:new Date})}finally{this.isTyping=!1,this.renderMessages()}}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>new o):new o})();})();
