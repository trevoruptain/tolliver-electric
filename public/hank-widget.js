(()=>{(function(){let n={primaryColor:"#0066CC",agentBubbleColor:"#E9E9EB",userBubbleColor:"#0066CC",agentTextColor:"#000000",userTextColor:"#FFFFFF",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',apiUrl:window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="::1"||window.location.hostname.startsWith("192.168.")||window.location.hostname.startsWith("10.")?"http://localhost:3000/api/widget":"https://app.dialhank.com/api/widget"},o='.hank-widget-container{position: fixed;bottom: 20px;right: 20px;z-index: 99999;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;display: flex;flex-direction: column;align-items: flex-end;}.hank-widget-launcher{width: 60px;height: 60px;border-radius: 30px;background-color: #007AFF;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);cursor: pointer;display: flex;align-items: center;justify-content: center;transition: transform 0.2s ease;position: relative;}.hank-widget-badge{position: absolute;top: -5px;right: -5px;background-color: #FF3B30;color: white;border-radius: 50%;width: 24px;height: 24px;display: flex;align-items: center;justify-content: center;font-size: 12px;font-weight: bold;border: 2px solid white;box-shadow: 0 2px 4px rgba(0,0,0,0.2);}.hank-widget-launcher:hover{transform: scale(1.05);}.hank-widget-launcher svg{width: 30px;height: 30px;fill: white;}.hank-widget-window{position: fixed;bottom: 90px;right: 20px;width: 375px;height: 600px;max-height: calc(100vh - 120px);background-color: #fff;border-radius: 18px;box-shadow: 0 5px 40px rgba(0,0,0,0.16);display: flex;flex-direction: column;overflow: hidden;transition: opacity 0.3s ease, transform 0.3s ease;opacity: 0;transform: translateY(20px);pointer-events: none;}.hank-widget-window.open{opacity: 1;transform: translateY(0);pointer-events: all;}/* Mobile responsiveness */ @media (max-width: 480px){.hank-widget-window{width: 100%;height: 100%;max-height: 100%;bottom: 0;right: 0;border-radius: 0;}}.hank-noscroll{overflow: hidden !important;}.hank-widget-header{padding: 16px;background-color: rgba(242, 242, 247, 0.8);backdrop-filter: blur(20px);-webkit-backdrop-filter: blur(20px);border-bottom: 1px solid rgba(0,0,0,0.1);display: flex;align-items: center;justify-content: space-between;position: absolute;top: 0;left: 0;width: 100%;z-index: 10;box-sizing: border-box;}.hank-widget-header-content{display: flex;align-items: center;gap: 12px;}.hank-widget-avatar{width: 48px;height: 48px;border-radius: 50%;background: linear-gradient(135deg, #4ade80 0%, #10b981 50%, #0d9488 100%);display: flex;align-items: center;justify-content: center;color: white;font-weight: bold;font-size: 20px;}.hank-widget-title{font-size: 16px;font-weight: 600;color: #000;}.hank-widget-subtitle{font-size: 12px;color: #8e8e93;}.hank-widget-close{background: none;border: none;cursor: pointer;color: #8e8e93;padding: 4px;}.hank-widget-messages{flex: 1;overflow-y: auto;padding: 16px;padding-top: 90px;/* Space for absolute header */ background-color: #fff;display: flex;flex-direction: column;gap: 8px;}.hank-message{max-width: 75%;padding: 10px 16px;border-radius: 20px;font-size: 16px;line-height: 1.4;position: relative;word-wrap: break-word;}.hank-message.agent{align-self: flex-start;background-color: #E9E9EB;color: #000000;border-bottom-left-radius: 4px;}.hank-message.user{align-self: flex-end;background-color: #007AFF;color: #FFFFFF;border-bottom-right-radius: 4px;}.hank-widget-input-area{padding: 16px;background-color: #f9f9f9;border-top: 1px solid rgba(0,0,0,0.1);display: flex;align-items: center;gap: 10px;}.hank-widget-input{flex: 1;border: 1px solid #c6c6c8;border-radius: 20px;padding: 8px 16px;font-size: 16px;outline: none;font-family: inherit;resize: none;height: 36px;max-height: 100px;line-height: 20px;overflow-y: auto;/* Hide scrollbar on all devices */ scrollbar-width: none;/* Firefox */ -ms-overflow-style: none;/* IE and Edge */}.hank-widget-input::-webkit-scrollbar{display: none;/* Chrome, Safari, Opera */}.hank-widget-input:focus{border-color: #007AFF;}.hank-widget-send{background: none;border: none;cursor: pointer;color: #007AFF;padding: 4px;display: flex;align-items: center;justify-content: center;}.hank-widget-send:disabled{opacity: 0.5;cursor: not-allowed;}.hank-message-timestamp{font-size: 10px;margin-top: 4px;opacity: 0.6;text-align: right;}.hank-typing-indicator{display: flex;gap: 4px;padding: 12px 16px;background-color: #E9E9EB;border-radius: 20px;border-bottom-left-radius: 4px;align-self: flex-start;width: fit-content;}.hank-typing-dot{width: 6px;height: 6px;background-color: #8e8e93;border-radius: 50%;animation: hank-bounce 1.4s infinite ease-in-out both;}.hank-typing-dot:nth-child(1){animation-delay: -0.32s;}.hank-typing-dot:nth-child(2){animation-delay: -0.16s;}@keyframes hank-bounce{0%, 80%, 100%{transform: scale(0);}40%{transform: scale(1);}}.hank-chips-container{display: flex;flex-wrap: wrap;gap: 8px;padding: 0 4px 8px 4px;margin-top: auto;/* Push to bottom of message area */}.hank-chip{background-color: #F2F2F7;border: 1px solid #E5E5EA;border-radius: 16px;padding: 8px 12px;font-size: 14px;color: #007AFF;cursor: pointer;transition: all 0.2s;font-weight: 500;display: flex;align-items: center;gap: 6px;}.hank-chip svg{width: 16px;height: 16px;}.hank-chip:hover{background-color: #E5E5EA;transform: translateY(-1px);}';class a{constructor(){this.isOpen=!1,this.messages=[],this.chips=[{label:"Water Damage",message:"I have water damage.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>'},{label:"Fire Damage",message:"I have fire damage.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.011.535-5.461a.034.034 0 0 1 .063-.005c.726 1.546 1.4 2.966 1.4 4.466C12 9.1 12.55 10 13.5 10c.42 0 .8-.16 1.1-.43a.03.03 0 0 1 .05.02c0 .83-.5 1.5-1.1 1.91-.66.45-1.55 1.1-1.55 2.01 0 1.1.9 2 2 2a1.9 1.9 0 0 0 1.6-1c.1-.16.3-.16.42 0 .7.97 1.48 1.25 2.48 1.25a.02.02 0 0 1 .02.02c0 .01-.01.02-.02.02-.8.05-1.55.3-2.15.75-.7.53-1.35 1.46-1.35 2.51 0 1.1.9 2 2 2 .62 0 1.2-.25 1.63-.66.1-.1.26-.1.37.02.4.43.9.64 1.5.64H21v-1a9 9 0 0 0-9-9c-2.4 0-4.6 1-6.3 2.6a.03.03 0 0 1-.05-.02C5.8 11.7 6.5 10.3 8.5 7c.1-.16.05-.37-.12-.46-.62-.33-1.38-.54-2.38-.54-2.2 0-4 1.8-4 4 0 2.2 1.8 4 4 4 .72 0 1.38-.17 1.95-.47.16-.09.36-.03.45.13.2.35.6.59 1.1.59Z"></path></svg>'},{label:"Mold Removal",message:"I have a mold problem.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>'},{label:"Book Appointment",message:"I'd like to schedule an appointment.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>'},{label:"Emergency",message:"I have an electrical emergency.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>'},{label:"General Question",message:"I have a general question.",icon:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>'}],this.showChips=!0,this.isTyping=!1,this.init()}init(){this.injectStyles(),this.createDOM(),this.attachEvents(),this.originalTitle=document.title,this.createChatSession(),setTimeout(()=>{this.playNotificationSound(),this.addInitialMessage(),window.innerWidth>768&&this.toggle(!0),this.showBadge(),this.startTitleNotification()},3e3)}async createChatSession(){try{let t=await(await fetch(`${n.apiUrl}/chat`,{method:"POST"})).json();this.chatId=t.chatId}catch(e){console.error("Failed to create chat session:",e)}}addInitialMessage(){this.messages.push({id:1,text:"Hey, is there anything I can help you with?",sender:"agent",timestamp:new Date}),this.renderMessages()}showBadge(){this.badge.style.display="flex",this.badge.innerText="1"}hideBadge(){this.badge.style.display="none",this.stopTitleNotification()}startTitleNotification(){if(this.titleInterval)return;let e=!1;this.titleInterval=setInterval(()=>{document.title=e?`(1) ${this.originalTitle}`:this.originalTitle,e=!e},2e3)}stopTitleNotification(){this.titleInterval&&(clearInterval(this.titleInterval),this.titleInterval=null,document.title=this.originalTitle)}playNotificationSound(){try{let e=window.AudioContext||window.webkitAudioContext;if(!e)return;let t=new e,i=t.createOscillator(),s=t.createGain();i.connect(s),s.connect(t.destination),i.type="sine",i.frequency.setValueAtTime(880,t.currentTime),i.frequency.exponentialRampToValueAtTime(440,t.currentTime+.1),s.gain.setValueAtTime(.1,t.currentTime),s.gain.exponentialRampToValueAtTime(.001,t.currentTime+.5),i.start(),i.stop(t.currentTime+.5)}catch(e){console.log("Audio playback failed (likely due to autoplay policy)",e)}}injectStyles(){let e=document.createElement("style");e.innerText=o,document.head.appendChild(e)}createDOM(){this.container=document.createElement("div"),this.container.className="hank-widget-container",this.window=document.createElement("div"),this.window.className="hank-widget-window",this.window.innerHTML=`
        <div class="hank-widget-header">
          <div class="hank-widget-header-content">
            <div class="hank-widget-avatar">H</div>
            <div>
              <div class="hank-widget-title">Hank</div>
              <div class="hank-widget-subtitle">Technician @ Cleaner Guys</div>
            </div>
          </div>
          <button class="hank-widget-close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>
        <div class="hank-widget-messages"></div>
        <div class="hank-widget-input-area">
          <textarea class="hank-widget-input" placeholder="Type a message..." rows="1"></textarea>
          <button class="hank-widget-send" disabled>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
          </button>
        </div>
      `,this.launcher=document.createElement("div"),this.launcher.className="hank-widget-launcher",this.launcher.innerHTML=`
        <div class="hank-widget-badge" style="display:none;">1</div>
        <svg class="hank-icon-open" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        <svg class="hank-icon-close" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none;"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      `,this.container.appendChild(this.window),this.container.appendChild(this.launcher),document.body.appendChild(this.container),this.messagesContainer=this.window.querySelector(".hank-widget-messages"),this.input=this.window.querySelector(".hank-widget-input"),this.sendBtn=this.window.querySelector(".hank-widget-send"),this.closeBtn=this.window.querySelector(".hank-widget-close"),this.badge=this.launcher.querySelector(".hank-widget-badge")}attachEvents(){this.launcher.addEventListener("click",()=>this.toggle()),this.closeBtn.addEventListener("click",()=>this.toggle(!1)),this.input.addEventListener("input",e=>{this.sendBtn.disabled=!e.target.value.trim(),this.hideBadge(),e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"}),this.input.addEventListener("keydown",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.sendMessage())}),this.sendBtn.addEventListener("click",()=>this.sendMessage())}toggle(e){typeof e=="boolean"?this.isOpen=e:this.isOpen=!this.isOpen;let t=window.innerWidth<=480;this.isOpen?(this.window.classList.add("open"),this.launcher.querySelector(".hank-icon-open").style.display="none",this.launcher.querySelector(".hank-icon-close").style.display="block",t&&(this.launcher.style.display="none",document.body.classList.add("hank-noscroll")),setTimeout(()=>this.input.focus(),300)):(this.window.classList.remove("open"),this.launcher.style.display="flex",this.launcher.querySelector(".hank-icon-open").style.display="block",this.launcher.querySelector(".hank-icon-close").style.display="none",document.body.classList.remove("hank-noscroll"),this.stopTitleNotification())}renderMessages(){if(this.messagesContainer.innerHTML="",this.messages.forEach(e=>{let t=document.createElement("div");t.className=`hank-message ${e.sender}`,t.innerText=e.text,this.messagesContainer.appendChild(t)}),this.showChips&&!this.isTyping){let e=document.createElement("div");e.className="hank-chips-container",this.chips.forEach(t=>{let i=document.createElement("button");i.className="hank-chip",i.innerHTML=`${t.icon}<span>${t.label}</span>`,i.onclick=()=>this.handleChipClick(t.message),e.appendChild(i)}),this.messagesContainer.appendChild(e)}if(this.isTyping){let e=document.createElement("div");e.className="hank-typing-indicator",e.innerHTML='<div class="hank-typing-dot"></div><div class="hank-typing-dot"></div><div class="hank-typing-dot"></div>',this.messagesContainer.appendChild(e)}this.scrollToBottom()}handleChipClick(e){this.input.value=e,this.showChips=!1,this.sendMessage()}scrollToBottom(){this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}async sendMessage(){let e=this.input.value.trim();if(e){this.showChips=!1,this.messages.push({id:Date.now(),text:e,sender:"user",timestamp:new Date}),this.input.value="",this.input.style.height="36px",this.sendBtn.disabled=!0,this.renderMessages(),this.isTyping=!0,this.renderMessages();try{this.chatId||await this.createChatSession();let s=(await(await fetch(`${n.apiUrl}/message`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:this.chatId,content:e})})).json()).messages?.[0]?.content||"Sorry, I couldn't process that.";this.messages.push({id:Date.now()+1,text:s,sender:"agent",timestamp:new Date})}catch(t){console.error("Error sending message:",t),this.messages.push({id:Date.now()+1,text:"Sorry, I'm having trouble connecting right now. Please try again later.",sender:"agent",timestamp:new Date})}finally{this.isTyping=!1,this.renderMessages()}}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>new a):new a})();})();
